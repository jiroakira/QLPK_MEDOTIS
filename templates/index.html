{% extends 'base.html' %}
{% load static %}

{% block stylesheet %}
<link href="{% static 'assets/css/owl.carousel.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'assets/css/owl.theme.default.min.css' %}" rel="stylesheet" type="text/css" />
{% endblock stylesheet %}
 
{% block content %}
 
<!--begin::Content-->
<div class="content d-flex flex-column flex-column-fluid" id="kt_content">
    <!--begin::Subheader-->
    <div class="subheader py-2 py-lg-4 subheader-solid" id="kt_subheader">
        <div class="container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap">
            <!--begin::Info-->
            <div class="d-flex align-items-center flex-wrap mr-2">
                <!--begin::Page Title-->
                <h5 class="text-dark font-weight-bold mt-2 mb-2 mr-5">Trang chủ</h5>
                <!--end::Page Title-->
            </div>
            <!--end::Info-->
        </div>
    </div>
    <!--end::Subheader-->
 
 
    <!--begin::Entry-->
    <div class="d-flex flex-column-fluid">
        <!--begin::Container-->
        <div class="container">
            <!--begin::Dashboard-->
            <div class="row text-center mb-4">
                {% comment %} <div class="col-xxl-1"></div> {% endcomment %}
                <div class="col-lg-12 col-xxl-12">
                    <div class="owl-carousel">
                        {% for bai_dang in bai_dang %}
                            <div class="item">
                                <a href="{% url 'chi_tiet_bai_dang' bai_dang.id %}" class="menu-link">
                                    <div class="bgi-no-repeat bgi-size-cover rounded-top min-h-225px w-auto" style="background-image: url({{bai_dang.hinh_anh.url}})" data-id-bai-dang="{{bai_dang.id}}">
                                    </div>
                                    {% comment %} <img src="{{bai_dang.hinh_anh.url}}" alt="Owl Image" class=" rounded min-h-225px w-50"> {% endcomment %}
                                    <div class=" min-h-60px w-auto bg-gray-500 rounded-bottom">
                                        <span class="text text-white menu-text">
                                            {{bai_dang.tieu_de}}
                                        </span>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <!--begin::Row-->
            <div class="row">
                <div class="col-lg-6 col-xxl-4">
                    <!--begin::Mixed Widget 1-->
                    <div class="card card-custom bg-gray-100 card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 bg-primary py-5">
                            <h1 class="card-title font-weight-bolder font-size-h2 text-white">Thao Tác</h1>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body p-0 position-relative overflow-hidden">
                            <!--begin::Chart-->
                            <div id="kt_mixed_widget_1_chart" class="card-rounded-bottom bg-primary" style="height: 150px"></div>
                            <!--end::Chart-->
                            <!--begin::Stats-->
                            <div class="card-spacer mt-n17">
                                <!--begin::Row-->
                                <div class="row m-0">
                                    <div class="col bg-light-warning px-6 py-8 rounded-xl mr-7 mb-7">
                                        <i class="la la-calendar icon-3x text-warning d-block my-2"></i>
                                        <a href="javascript:;" class="addLichHenKhamBtn text-warning font-weight-bold font-size-h6">Thêm Mới Lịch Hẹn</a>
                                    </div>
                                    <div class="col bg-light-primary px-6 py-8 rounded-xl mb-7">
                                        <span class="svg-icon svg-icon-3x svg-icon-primary d-block my-2">
                                            <!--begin::Svg Icon | path:/metronic/theme/html/demo1/dist/assets/media/svg/icons/Communication/Add-user.svg-->
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <polygon points="0 0 24 0 24 24 0 24" />
                                                    <path d="M18,8 L16,8 C15.4477153,8 15,7.55228475 15,7 C15,6.44771525 15.4477153,6 16,6 L18,6 L18,4 C18,3.44771525 18.4477153,3 19,3 C19.5522847,3 20,3.44771525 20,4 L20,6 L22,6 C22.5522847,6 23,6.44771525 23,7 C23,7.55228475 22.5522847,8 22,8 L20,8 L20,10 C20,10.5522847 19.5522847,11 19,11 C18.4477153,11 18,10.5522847 18,10 L18,8 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                    <path d="M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                                                </g>
                                            </svg>
                                            <!--end::Svg Icon-->
                                        </span>
                                        <a href="javascript:;" class="btn-register-user text-primary font-weight-bold font-size-h6 mt-2" >Thêm Mới Người Dùng</a>
                                    </div>
                                </div>
                                <!--end::Row-->
                                <!--begin::Row-->
                                <div class="row m-0">
                                    <div class="col bg-light-danger px-6 py-8 rounded-xl mr-7">
                                        <span class="svg-icon svg-icon-3x svg-icon-danger d-block my-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect x="0" y="0" width="24" height="24" />
                                                    <path d="M12.7037037,14 L15.6666667,10 L13.4444444,10 L13.4444444,6 L9,12 L11.2222222,12 L11.2222222,14 L6,14 C5.44771525,14 5,13.5522847 5,13 L5,3 C5,2.44771525 5.44771525,2 6,2 L18,2 C18.5522847,2 19,2.44771525 19,3 L19,13 C19,13.5522847 18.5522847,14 18,14 L12.7037037,14 Z" fill="#000000" opacity="0.3" />
                                                    <path d="M9.80428954,10.9142091 L9,12 L11.2222222,12 L11.2222222,16 L15.6666667,10 L15.4615385,10 L20.2072547,6.57253826 C20.4311176,6.4108595 20.7436609,6.46126971 20.9053396,6.68513259 C20.9668779,6.77033951 21,6.87277228 21,6.97787787 L21,17 C21,18.1045695 20.1045695,19 19,19 L5,19 C3.8954305,19 3,18.1045695 3,17 L3,6.97787787 C3,6.70173549 3.22385763,6.47787787 3.5,6.47787787 C3.60510559,6.47787787 3.70753836,6.51099993 3.79274528,6.57253826 L9.80428954,10.9142091 Z" fill="#000000" />
                                                </g>
                                            </svg>
                                        </span>
                                        <a href="{% url 'them_dich_vu_kham' %}" class="addServicesBtn text-danger font-weight-bold font-size-h6 mt-2">Thêm Mới Dịch Vụ Khám</a>
                                    </div>
                                    <div class="col bg-light-success px-6 py-8 rounded-xl">
                                        <span class="svg-icon svg-icon-3x svg-icon-success d-block my-2">
                                            <!--begin::Svg Icon | path:/metronic/theme/html/demo1/dist/assets/media/svg/icons/Communication/Urgent-mail.svg-->
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect opacity="0.300000012" x="0" y="0" width="24" height="24"/>
                                                    <polygon fill="#000000" fill-rule="nonzero" opacity="0.3" points="7 4.89473684 7 21 5 21 5 3 11 3 11 4.89473684"/>
                                                    <path d="M10.1782982,2.24743315 L18.1782982,3.6970464 C18.6540619,3.78325557 19,4.19751166 19,4.68102291 L19,19.3190064 C19,19.8025177 18.6540619,20.2167738 18.1782982,20.3029829 L10.1782982,21.7525962 C9.63486295,21.8510675 9.11449486,21.4903531 9.0160235,20.9469179 C9.00536265,20.8880837 9,20.8284119 9,20.7686197 L9,3.23140966 C9,2.67912491 9.44771525,2.23140966 10,2.23140966 C10.0597922,2.23140966 10.119464,2.2367723 10.1782982,2.24743315 Z M11.9166667,12.9060229 C12.6070226,12.9060229 13.1666667,12.2975724 13.1666667,11.5470105 C13.1666667,10.7964487 12.6070226,10.1879981 11.9166667,10.1879981 C11.2263107,10.1879981 10.6666667,10.7964487 10.6666667,11.5470105 C10.6666667,12.2975724 11.2263107,12.9060229 11.9166667,12.9060229 Z" fill="#000000"/>
                                                </g>
                                            </svg>
                                            <!--end::Svg Icon-->
                                        </span>
                                        <a href="{% url 'them_phong_chuc_nang' %}" class="addPhongChucNangBtn text-success font-weight-bold font-size-h6 mt-2">Thêm Mới Phòng Chức Năng</a>
                                    </div>
                                </div>
                                <!--end::Row-->
                            </div>
                            <!--end::Stats-->
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Mixed Widget 1-->
                </div>
 
                <div class="col-lg-6 col-xxl-8">
                    <!--begin::Stats Widget 11-->
                    <div class="card card-custom card-stretch card-stretch-half gutter-b">
                        <!--begin::Body-->
                        <div class="card-body p-0">
                            <div class="d-flex align-items-center justify-content-between card-spacer flex-grow-1">
                                <span class="symbol symbol-50 symbol-light-success mr-2">
                                    <a href="{% url 'doanh_thu_phong_kham' %}">
                                        <span class="symbol-label">
                                        <span class="svg-icon svg-icon-xl svg-icon-success">
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect x="0" y="0" width="24" height="24" />
                                                    <rect fill="#000000" opacity="0.3" x="13" y="4" width="3" height="16" rx="1.5" />
                                                    <rect fill="#000000" x="8" y="9" width="3" height="11" rx="1.5" />
                                                    <rect fill="#000000" x="18" y="11" width="3" height="9" rx="1.5" />
                                                    <rect fill="#000000" x="3" y="13" width="3" height="7" rx="1.5" />
                                                </g>
                                            </svg>
                                        </span>
                                    </span>
                                    </a>
                                </span>
                                <div class="d-flex flex-column text-right">
                                    {% comment %} <span class="text-dark-75 font-weight-bolder "></span> {% endcomment %}
                                    <span class="font-weight-bold font-size-h5">Tổng Hợp Doanh Thu 7 Ngày Gần Đây</span>
                                </div>
                            </div>
                            <div id="chart_3"></div>
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Stats Widget 11-->
                    <!--begin::New User-->
                    <div class="card card-custom card-stretch card-stretch-half gutter-b">
                        <!--begin::Body-->
                        <div class="card-body p-0">
                            <div class="d-flex align-items-center justify-content-between card-spacer flex-grow-1">
                                <span class="symbol symbol-50 symbol-light-success mr-2">
                                    <a href="{% url 'doanh_thu_phong_kham' %}">
                                        <span class="symbol-label">
                                        <span class="svg-icon svg-icon-xl svg-icon-success">
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <rect x="0" y="0" width="24" height="24" />
                                                    <rect fill="#000000" opacity="0.3" x="13" y="4" width="3" height="16" rx="1.5" />
                                                    <rect fill="#000000" x="8" y="9" width="3" height="11" rx="1.5" />
                                                    <rect fill="#000000" x="18" y="11" width="3" height="9" rx="1.5" />
                                                    <rect fill="#000000" x="3" y="13" width="3" height="7" rx="1.5" />
                                                </g>
                                            </svg>
                                        </span>
                                    </span>
                                    </a>
                                </span>
                                <div class="d-flex flex-column text-right">
                                    {% comment %} <span class="text-dark-75 font-weight-bolder "></span> {% endcomment %}
                                    <span class="font-weight-bold font-size-h5">Tổng Hợp Số Lượng Bệnh Nhân Mới 7 Ngày Gần Đây</span>
                                </div>
                            </div>
                            <div id="chart_4"></div>
                        </div>
                        <!--end::Body-->
                    </div>
                    {% comment %} <div class="card card-custom card-stretch card-stretch-half gutter-b">
                        <!--begin::Body-->
                        <div class="card-body p-0">
                            <div class="d-flex align-items-center justify-content-between card-spacer flex-grow-1">
                                <span class="symbol symbol-50 symbol-light-primary mr-2">
                                    <span class="symbol-label">
                                        <span class="svg-icon svg-icon-xl svg-icon-primary">
                                            <!--begin::Svg Icon | path:/metronic/theme/html/demo1/dist/assets/media/svg/icons/Communication/Group.svg-->
                                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                    <polygon points="0 0 24 0 24 24 0 24" />
                                                    <path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                    <path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                                                </g>
                                            </svg>
                                            <!--end::Svg Icon-->
                                        </span>
                                    </span>
                                </span>
                                <div class="d-flex flex-column text-right">
                                    <span class="text-dark-75 font-weight-bolder font-size-h3">+{{ new_users_count }}</span>
                                    <span class="text-muted font-weight-bold mt-2">Người dùng mới</span>
                                </div>
                            </div>
                            <div id="kt_stats_widget_12_chart" data-color="primary" style="height: 150px"></div>
                        </div>
                        <!--end::Body-->
                    </div> {% endcomment %}
                    <!--end::New User-->
                </div>
            </div>
            <!-- end::Row -->
 
            <!-- begin::Row -->
            <div class="row">
                <div class="col-xxl-4 col-lg-4 order-2 order-xxl-1">
                    <!--begin::Advance Table Widget 2-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label font-weight-bolder text-dark">Danh sách bệnh nhân đăng ký mới trong 1 tuần qua</span>
                                <span class="text-muted mt-3 font-weight-bold font-size-sm">Thông tin cơ bản của các bệnh nhân mới</span>
                            </h3>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2 pb-0 mt-n3">
                            <div class="tab-content mt-5" id="myTabTables11">
                                <!--begin::Tap pane-->
                                <div class="tab-pane fade show active" id="kt_tab_pane_11_3" role="tabpanel" aria-labelledby="kt_tab_pane_11_3">
                                    <!--begin::Table-->
                                    <div class="table-responsive">
                                        <table class="table table-borderless table-vertical-center">
                                            <thead>
                                                <tr>
                                                    <th class="p-0 min-w-180px">Thông tin</th>
                                                    <td class="pr-5 text-right">
                                                        <span class="text-muted font-weight-bold">SDT</span>
                                                    </td>
                                                    {% comment %} <th class="p-0 min-w-150px"></th> {% endcomment %}
                                                </tr>
                                            </thead>
                                            <tbody>
 
                                            {% for regUser in user_trong_ngay %}
                                                <tr>
                                                    <td class="pl-0">
                                                        <a href="javascript:;" class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-md">{{ regUser.ho_ten }}</a>
                                                        <div>
                                                            <span class="font-weight-bolder">Địa Chỉ:</span>
                                                            <a class="text-muted font-weight-bold text-hover-primary" href="javascript:;">
                                                                {{ regUser.get_dia_chi }}
                                                            </a>
                                                        </div>
                                                    </td>
                                                    <td class="text-right">
                                                        <span class="text-dark-75 font-weight-bolder d-block font-size-lg"> {{ regUser.so_dien_thoai }} </span>
                                                        <span class="text-muted font-weight-bold"></span>
                                                    </td>
                                                </tr>
                                            {% endfor %}
 
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--end::Table-->
                                </div>
                                <!--end::Tap pane-->
                            </div>
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Advance Table Widget 2-->
                </div>
 
                 <div class="col-lg-8 col-xxl-8 order-1 order-xxl-1">
                    <!--begin::Base Table Widget 10-->
                    <div class="card card-custom card-stretch gutter-b">
                        <!--begin::Header-->
                        <div class="card-header border-0 pt-5">
                            <h3 class="card-title align-items-start flex-column">
                                <span class="card-label font-weight-bolder text-dark">Lịch Hẹn Sắp Tới</span>
                                <span class="text-muted mt-3 font-weight-bold font-size-sm">Lịch hẹn mới trong ngày</span>
                            </h3>
                            <div class="card-toolbar">
                                <ul class="nav nav-pills nav-pills-sm nav-dark-75">
                                    <li class="nav-item">
                                        <a class="nav-link py-2 px-4 active font-weight-bolder" data-toggle="tab" href="#kt_tab_pane_10_1">Sắp tới</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link py-2 px-4 font-weight-bolder" data-toggle="tab" href="#kt_tab_pane_10_3">Trước đó</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--end::Header-->
                        <!--begin::Body-->
                        <div class="card-body pt-2 pb-0 mt-n3">
                            <div class="tab-content mt-5" id="myTabTables10">
                                <!--begin::Tap pane-->
                                <div class="tab-pane fade show active" id="kt_tab_pane_10_1" role="tabpanel" aria-labelledby="kt_tab_pane_10_1">
                                    <!--begin::Table-->
                                    <div class="table-responsive">
                                        <table class="table table-borderless table-vertical-center">
                                            <!--begin::Thead-->
                                            <thead>
                                                <tr>
                                                    <th class="p-0 w-50px"></th>
                                                    <th class="p-0 w-100 min-w-200px"></th>
                                                    <th class="p-0"></th>
                                                    <th class="p-0 min-w-130px w-100"></th>
                                                </tr>
                                            </thead>
                                            <!--end::Thead-->
                                            <!--begin::Tbody-->
                                            <tbody>
                                                {% for event in upcoming_events %}
                                                <tr>
                                                    <td class="pl-0 py-5">
                                                        <div class="symbol symbol-45 symbol-light-info mr-2">
                                                            <span class="symbol-label">
                                                                <span class="svg-icon svg-icon-2x svg-icon-info">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                            <polygon points="0 0 24 0 24 24 0 24"/>
                                                                            <path d="M12,11 C9.790861,11 8,9.209139 8,7 C8,4.790861 9.790861,3 12,3 C14.209139,3 16,4.790861 16,7 C16,9.209139 14.209139,11 12,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                                            <path d="M3.00065168,20.1992055 C3.38825852,15.4265159 7.26191235,13 11.9833413,13 C16.7712164,13 20.7048837,15.2931929 20.9979143,20.2 C21.0095879,20.3954741 20.9979143,21 20.2466999,21 C16.541124,21 11.0347247,21 3.72750223,21 C3.47671215,21 2.97953825,20.45918 3.00065168,20.1992055 Z" fill="#000000" fill-rule="nonzero"/>
                                                                        </g>
                                                                    </svg>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </td>
                                                    <td class="pl-0">
                                                        <a href="#" class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">{{ event.benh_nhan.ho_ten }}</a>
                                                        <span class="text-muted font-weight-bold d-block">Bệnh Nhân</span>
                                                    </td>
                                                    <td></td>
                                                    <td class="text-left">
                                                        <span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{ event.thoi_gian_bat_dau|date:'d-m-Y' }}</span>
                                                        <span class="text-muted font-weight-bold d-block font-size-sm">{{ event.thoi_gian_bat_dau|date:'H:i' }}</span>
                                                    </td>
                                                    <td class="text-right pr-0">
                                                        <a href="#" class="btn btn-icon btn-light btn-sm">
                                                            <span class="svg-icon svg-icon-md svg-icon-success">
                                                                <!--begin::Svg Icon | path:/metronic/theme/html/demo1/dist/assets/media/svg/icons/Navigation/Arrow-right.svg-->
                                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                        <polygon points="0 0 24 0 24 24 0 24" />
                                                                        <rect fill="#000000" opacity="0.3" transform="translate(12.000000, 12.000000) rotate(-90.000000) translate(-12.000000, -12.000000)" x="11" y="5" width="2" height="14" rx="1" />
                                                                        <path d="M9.70710318,15.7071045 C9.31657888,16.0976288 8.68341391,16.0976288 8.29288961,15.7071045 C7.90236532,15.3165802 7.90236532,14.6834152 8.29288961,14.2928909 L14.2928896,8.29289093 C14.6714686,7.914312 15.281055,7.90106637 15.675721,8.26284357 L21.675721,13.7628436 C22.08284,14.136036 22.1103429,14.7686034 21.7371505,15.1757223 C21.3639581,15.5828413 20.7313908,15.6103443 20.3242718,15.2371519 L15.0300721,10.3841355 L9.70710318,15.7071045 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.999999, 11.999997) scale(1, -1) rotate(90.000000) translate(-14.999999, -11.999997)" />
                                                                    </g>
                                                                </svg>
                                                                <!--end::Svg Icon-->
                                                            </span>
                                                        </a>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                            <!--end::Tbody-->
                                        </table>
                                    </div>
                                    <!--end::Table-->
                                </div>
                                <!--end::Tap pane-->
                                <!--begin::Tap pane-->
                                <div class="tab-pane fade" id="kt_tab_pane_10_3" role="tabpanel" aria-labelledby="kt_tab_pane_10_3">
                                    <!--begin::Table-->
                                    <div class="table-responsive">
                                        <table class="table table-borderless table-vertical-center">
                                            <!--begin::Thead-->
                                            <thead>
                                                <tr>
                                                    <th class="p-0 w-50px"></th>
                                                    <th class="p-0 w-100 min-w-200px"></th>
                                                    <th class="p-0"></th>
                                                    <th class="p-0 min-w-130px w-100"></th>
                                                </tr>
                                            </thead>
                                            <!--end::Thead-->
                                            <!--begin::Tbody-->
                                            <tbody>
                                                {% for event in past_events %}
                                                <tr>
                                                    <td class="pl-0 pt-0 py-5">
                                                        <div class="symbol symbol-45 symbol-light-success mr-2">
                                                            <span class="symbol-label">
                                                                <span class="svg-icon svg-icon-2x svg-icon-success">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                            <polygon points="0 0 24 0 24 24 0 24"/>
                                                                            <path d="M12,11 C9.790861,11 8,9.209139 8,7 C8,4.790861 9.790861,3 12,3 C14.209139,3 16,4.790861 16,7 C16,9.209139 14.209139,11 12,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3"/>
                                                                            <path d="M3.00065168,20.1992055 C3.38825852,15.4265159 7.26191235,13 11.9833413,13 C16.7712164,13 20.7048837,15.2931929 20.9979143,20.2 C21.0095879,20.3954741 20.9979143,21 20.2466999,21 C16.541124,21 11.0347247,21 3.72750223,21 C3.47671215,21 2.97953825,20.45918 3.00065168,20.1992055 Z" fill="#000000" fill-rule="nonzero"/>
                                                                        </g>
                                                                    </svg>
                                                                </span>
                                                            </span>
                                                        </div>
                                                    </td>
                                                    <td class="pl-0">
                                                        <a href="javascript:;" class="text-dark-75 font-weight-bolder text-hover-primary mb-1 font-size-lg">{{ event.benh_nhan.ho_ten }}</a>
                                                        <span class="text-muted font-weight-bold d-block">Bệnh Nhân</span>
                                                    </td>
                                                    <td></td>
                                                    <td class="text-left">
                                                        <span class="text-dark-75 font-weight-bolder d-block font-size-lg">{{ event.thoi_gian_bat_dau|date:'d-m-Y' }}</span>
                                                        <span class="text-muted font-weight-bold d-block font-size-sm">{{ event.thoi_gian_bat_dau|date:'H:i' }}</span>
                                                    </td>
                                                    <td class="text-right pr-0">
                                                        <a href="#" class="btn btn-icon btn-light btn-sm">
                                                            <span class="svg-icon svg-icon-md svg-icon-success">
                                                                <!--begin::Svg Icon | path:/metronic/theme/html/demo1/dist/assets/media/svg/icons/Navigation/Arrow-right.svg-->
                                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                                        <polygon points="0 0 24 0 24 24 0 24" />
                                                                        <rect fill="#000000" opacity="0.3" transform="translate(12.000000, 12.000000) rotate(-90.000000) translate(-12.000000, -12.000000)" x="11" y="5" width="2" height="14" rx="1" />
                                                                        <path d="M9.70710318,15.7071045 C9.31657888,16.0976288 8.68341391,16.0976288 8.29288961,15.7071045 C7.90236532,15.3165802 7.90236532,14.6834152 8.29288961,14.2928909 L14.2928896,8.29289093 C14.6714686,7.914312 15.281055,7.90106637 15.675721,8.26284357 L21.675721,13.7628436 C22.08284,14.136036 22.1103429,14.7686034 21.7371505,15.1757223 C21.3639581,15.5828413 20.7313908,15.6103443 20.3242718,15.2371519 L15.0300721,10.3841355 L9.70710318,15.7071045 Z" fill="#000000" fill-rule="nonzero" transform="translate(14.999999, 11.999997) scale(1, -1) rotate(90.000000) translate(-14.999999, -11.999997)" />
                                                                    </g>
                                                                </svg>
                                                                <!--end::Svg Icon-->
                                                            </span>
                                                        </a>
                                                    </td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                            <!--end::Tbody-->
                                        </table>
                                    </div>
                                    <!--end::Table-->
                                </div>
                                <!--end::Tap pane-->
                            </div>
                        </div>
                        <!--end::Body-->
                    </div>
                    <!--end::Base Table Widget 10-->
                </div>
            </div>
            <!--end::Row-->
 
            <!--end::Dashboard-->
        </div>
        <!--end::Container-->
    </div>
    <!--end::Entry-->
</div>
<!--end::Content-->

<!-- Register Modal-->
<div class="modal fade" id="registerModal" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Đăng Kí Tài Khoản Cho Người Dùng</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="card-body">
                        <div class="form-group mb-8">
                            <div class="alert alert-custom alert-default" role="alert">
                                <div class="alert-icon"><i class="flaticon-user-add text-primary"></i></div>
                                <div class="alert-text">
                                    Đăng Kí Tài Khoản
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Họ Tên</label>
                            <input type="text" class="form-control" id="inputNameModal"  placeholder="Nhập Đầy Đủ Họ Tên Của Bạn"/>
                            {% comment %} <span class="form-text text-muted">We'll never share your email with anyone else.</span> {% endcomment %}
                        </div>
                        <div class="form-group">
                            <label>Số Điện Thoại </label>
                            <input type="text" class="form-control" id="inputPhoneModal"  placeholder="Nhập Số Điện Thoại"/>
                            <span class="form-text text-muted" >Chúng tôi sẽ không chia sẻ dữ liệu này với bất kì ai</span>
                            <span class="text-danger" id="error_phone"></span>
                        </div>
                        <div class="form-group">
                            <label for="inputPasswordModal">Mật khẩu </label>
                            <input type="password" class="form-control" id="inputPasswordModal" placeholder="Password"/>
                        </div>
                        <div class="form-group">
                            <label>CMND/CCCD </label>
                            <input type="text" class="form-control" id="inputCmtModal" placeholder="Nhập CMND/CCCD"/>
                            {% comment %} <span class="text-danger" id="error_cccd"></span> {% endcomment %}
                        </div>
                        <div class="form-group">
                            <label>Địa chỉ </label>
                            <textarea class="form-control" id="inputDiaChiModal" placeholder="Địa chỉ người dùng" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Đóng</button>
                        <button type="button" class="registerModalSubmit btn btn-primary font-weight-bold">Tạo Tài Khoản</button>
                    </div>     
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Them moi lich hen kham Modal -->
<div class="modal fade" id="addLichHenKham" data-backdrop="static" tabindex="-1" role="dialog" aria-labelledby="staticBackdrop" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Thêm Mới Lịch Hẹn Khám</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <i aria-hidden="true" class="ki ki-close"></i>
                </button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="card-body">
                        <div class="form-group mb-8">
                            <div class="alert alert-custom alert-default" role="alert">
                                <div class="alert-icon"><i class="flaticon2-calendar-6 text-primary"></i></div>
                                <div class="alert-text">
                                    Thêm Lịch Hẹn Khám
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Chọn Dịch Vụ Khám </label>
                            <select id="selectDichVuKham" class="form-control selectpicker">
                                <option value="kham_chua_benh" selected>Khám Chữa Bệnh</option>
                                <option value="kham_sua_khoe">Khám Sức Khỏe</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Chọn Bệnh Nhân</label>
                            <select id="selectBenhNhan" class="form-control selectpicker" data-size="7" data-live-search="true">
                                <option value="" disabled selected>Chọn bệnh nhân</option>
                                {% for p in nguoi_dung %}
                                    <option value="{{ p.id }}">{{ p.ho_ten }} - {{ p.cmnd_cccd }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group" id="thongTinBenhNhan"></div>
                        <div class="input-group date mb-5" id="kt_datetimepicker_1" data-target-input="nearest">
                            <input type="text" id="inputLichHenKham" class="form-control datetimepicker-input" placeholder="Chọn thời gian bắt đầu" data-target="#kt_datetimepicker_1"/>
                            <div class="input-group-append" data-target="#kt_datetimepicker_1" data-toggle="datetimepicker">
                                <span class="input-group-text">
                                    <i class="ki ki-calendar"></i>
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Lý Do Đến Khám</label>
                            <textarea class="form-control" id="ly_do" rows="3" placeholder="Nhập triệu chứng/lý do khám của bệnh nhân"></textarea>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button type="button" class="btn btn-light-primary font-weight-bold" data-dismiss="modal">Đóng</button>
                        <button type="button" class="addLichHenKhamModalSubmit btn btn-primary font-weight-bold">Tạo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block scripts %}

<!--begin::Global Theme Bundle(used by all pages)-->
<script src="{% static 'assets/plugins/global/plugins.bundle9cd7.js' %} "></script>
<script src="{% static 'assets/js/scripts.bundle9cd7.js' %} "></script>
<script src="{% static 'assets/plugins/custom/prismjs/prismjs.bundle9cd7.js' %} "></script>
<script src="{% static 'assets/js/pages/crud/forms/widgets/bootstrap-datetimepicker9cd7.js' %} "></script>
<script src="{% static 'assets/js/pages/owl.carousel.min.js' %} "></script>

<!--end::Global Theme Bundle-->

<script>
    "use strict";

    // Shared Colors Definition
    const primary = '#6993FF';
    const success = '#1BC5BD';
    const info = '#8950FC';
    const warning = '#FFA800';
    const danger = '#F64E60';

    // Class definition
    var date = {{tong_tien_chuoi_kham|safe}}

    console.log(date)
    
    // Class definition
    var KTWidgets = function () {
        // Private properties
        // General Controls
        
        var owlCarousel = function() {
            $(document).ready(function(){
                $(".owl-carousel").owlCarousel({
                    stagePadding: 80,
                    margin:20,
                    nav:false,
                    autoWidth:false,
                    loop:true,
                    autoplay:true,
                    autoplayTimeout:2500,
                    autoplayHoverPause:true,
                    //items:4,
                    responsive:{
                        0:{
                            items:1,
                        },
                        480:{
                            items:3,
                        },
                        2000:{
                            items:5,
                        }
                    }
                });
            });
        }
        // Stats widgets

        var _initStatsWidget11 = function () {
            const apexChart = "#chart_3";
            var options = {
                series: [{
                    name: 'Dịch vụ khám',
                    data: {{ tong_tien_chuoi_kham|safe }}
                }, {
                    name: 'Thuốc',
                    data: {{ tong_tien_thuoc|safe }}
                }, {
                    name: 'Chi Phí Lâm Sàng',
                    data: {{ tong_tien_lam_sang|safe }}
                }],
                chart: {
                    type: 'bar',
                    height: 170
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '60%',
                        endingShape: 'flat'
                    },
                },
                dataLabels: {
                    enabled: false,
                },
                stroke: {
                    show: true,
                    width: 2,
                    colors: ['transparent']
                },
                xaxis: {
                    categories: {{ thoi_gian|safe }},
                },
                yaxis: {
                    title: {
                        text: 'VND'
                    },
                    ticks: {
                        callback: function(label, index, labels) {
                            return label/1000+'k';
                        }
                    },
                    scaleLabel: {
                        display: true,
                        labelString: '1k = 1000'
                    },
                },
                fill: {
                    opacity: 1
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            if (parseInt(val) >= 1000) {
                                return val.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " VND";
                            } else {
                                return val + " VND"
                            }
                        }
                    }
                },
                colors: ['#2E93fA', '#66DA26','#E91E63'],
            };

            var chart = new ApexCharts(document.querySelector(apexChart), options);
            chart.render();
        }

        var _initStatsWidget12 = function () {
            const apexChart = "#chart_4";
            var options = {
                series: [{
                    type: 'column',
                    name: 'Bệnh Nhân Mới',
                    data: {{ so_luong_nguoi_dung|safe }}
                }, {
                    type: 'line',
                    name: 'Bệnh Nhân Khám',
                    data: {{ so_luong_nguoi_dung_thuc_hien_kham|safe }}
                }],
                chart: {
                    type: 'line',
                    height: 170
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '60%',
                        endingShape: 'flat'
                    },
                },
                dataLabels: {
                    enabled: false,
                },
                stroke: {
                    show: true,
                    width: 2,
                    curve: 'smooth',
                },
                xaxis: {
                    categories: {{ thoi_gian|safe }},
                },
                yaxis: {
                    title: {
                        text: 'Người'
                    },
                    ticks: {
                        callback: function(label, index, labels) {
                            return label/1000+'k';
                        }
                    },
                    scaleLabel: {
                        display: true,
                        labelString: '1k = 1000'
                    },
                },
                fill: {
                    opacity: 1
                },
                tooltip: {
                    y: {
                        formatter: function (val) {
                            if (parseInt(val) >= 1000) {
                                return val.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " VND";
                            } else {
                                return val + " Người"
                            }
                        }
                    }
                },
                colors: ['#51adcf', '#66DA26'],
                markers: {
                    size: 2,
                }
            };

            var chart = new ApexCharts(document.querySelector(apexChart), options);
            chart.render();
        }


        var _initRegisterModal = function () {
            $(document).on('click', '.btn-register-user', function() {
                $('#registerModal').modal('show');
            });
        }

        var _initThemLichHenKham = function(){
            $(document).on('click', '.addLichHenKhamBtn', function(){
                $('#addLichHenKham').modal('show');
            })
        }

        var _formRegisterSubmit = function () {
            var formData = new FormData();
            $(document).on("click", ".registerModalSubmit", function() {
                $('#inputPhoneModal').on("change", function(){
                    var phone = document.getElementById("inputPhoneModal").value;
                    if(phone== "") {
                        document.getElementById('error_phone').innerHTML = 'Không được để trống';
                        return false;
                    }
                    else{
                        var regex_phone = /(84|0[3|5|7|8|9])+([0-9]{8})\b/gm;

                        var test_phone = regex_phone.test(phone);

                        if(test_phone==true){
                            document.getElementById('error_phone').innerHTML = 'Hợp lệ';
                        }
                        else{
                            document.getElementById('error_phone').innerHTML = 'Không hợp lệ';
                            return false;
                        }
                    }
                })

                formData.append('ho_ten', $("#inputNameModal").val())
                formData.append('so_dien_thoai', $("#inputPhoneModal").val())
                formData.append('cmnd_cccd', $("#inputCmtModal").val())
                formData.append('dia_chi', $("#inputDiaChiModal").val())
                formData.append('password', $("#inputPasswordModal").val())
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')


                $.ajax({
                    type: "POST",
                    url: "{% url 'create_user_index' %}",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    success: function(response){
                        if (response.status == 400) {
                            toastr.warning(response.message, "Xảy Ra Lỗi")
                        } else if (response.status == 409) {
                            toastr.info(response.message, "Lỗi")
                        } else if (response.status == 403){
                            toastr.info(response.message, "Lỗi")
                        } else {
                            toastr.success(response.message, "Thành Công")
                            //$('#registerModal').html('hide')
                        }
                        $('#registerModal').modal('hide');
                    },
                    error: function(response){
                        $('#registerModal').modal('hide');
                    }
                })
            })
        }

        var _formAddLichHenKham = function(){
            $('#selectBenhNhan').change(function(){
                var ma_benh_nhan = $(this).val();

                $.ajax({
                    type: "GET",
                    url: HOST_URL + '/api/thong_tin_benh_nhan_theo_ma/',
                    data: {ma_benh_nhan:ma_benh_nhan},
                    dataType: "json",
                    success: function (response) {
                        $(response).each(function() {
                            console.log(response)
                            if(response.thong_tin_theo_ma == null){
                                $(response.thong_tin_theo_ma.dia_chi).html("Không có thông tin")
                            }

                            $('#thongTinBenhNhan').empty();
                            $('#thongTinBenhNhan').html(`
                                <span class="text-muted">Địa chỉ: ${response.thong_tin_theo_ma.dia_chi}</span><br>
                                <span class="text-muted">Số điện thoại: ${response.thong_tin_theo_ma.so_dien_thoai}</span>
                            `)
                            
                        })
                    }
                });
            })
            
            var formData = new FormData();
            
            $(document).on("click", ".addLichHenKhamModalSubmit", function(){

                formData.append('thoi_gian_bat_dau', $("#inputLichHenKham").val())
                formData.append('id_benh_nhan', $("#selectBenhNhan").val())
                formData.append('ly_do', $('#ly_do').val())
                formData.append('loai_dich_vu', $('#selectDichVuKham').val())
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}')

                console.log($("#inputLichHenKham").val())
                console.log($("#selectBenhNhan").val())

                console.log($('#selectDichVuKham').val())
                console.log($('#ly_do').val())

                $.ajax({
                    type: "POST",
                    url: "{% url 'add_lich_hen' %}",
                    data: formData,
                    cache: false,
                    processData: false,
                    contentType: false,
                    success: function(response){
                        toastr.success(response.message, "Thêm Lịch Hẹn Thành Công")
                        {% comment %} $('#addLichHenKham').find("input").val("");  {% endcomment %}
                        $('#addLichHenKham').modal('hide');
                        $('#addLichhenkham').on("hidden.bs.modal", function(){
                            $('#addLichHenKham').find('.modal-body').html("")
                        })
                    },
                    error: function(response){
                        console.log(response.message)
                        toastr.warning(response.message)
                        $('#addLichHenKham').modal('hide');
                    }
                })
            })
        }

        // Public methods
        return {
            init: function () {
                // Stats Widgets
                _initStatsWidget11();		
                _initStatsWidget12();
                owlCarousel();
                //_initDatePickerLocale();

                _initRegisterModal();
                //_initThemPhongChucNang();
                _initThemLichHenKham();

                _formRegisterSubmit();
                _formAddLichHenKham();
            }
        }
    }();

    jQuery(document).ready(function () {
        KTWidgets.init();
    });

</script>
<!--end::Page Charts(used by this page)-->

{% endblock scripts %}